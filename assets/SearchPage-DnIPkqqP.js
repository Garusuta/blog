import{j as Q,r as p,k as U,l as ms,q as l,D as P,u as e,S as I,s as n,y as i,z as d,d as _,w as z,H as ps,n as fs,A as K,B as w,L as bs,R as gs,T as hs,F as x,C as T,v as y,x as $,E as _s,p as ws,O as ys}from"./vue-DoCjM5oa.js";import{_ as Y,u as ks,c as Cs}from"./index-CyOsP08U.js";import{P as xs}from"./PaginationComponent-DVgObo84.js";import"./libs--DbO3urw.js";import"./markdown--zrfzkwQ.js";import"./highlight-CjIDkcmk.js";import"./katex-734Zlhpu.js";const Ts=["aria-expanded"],$s=Q({__name:"CustomDropdown",props:{label:{default:"选择"},buttonClass:{default:"btn btn-outline-secondary"},menuClass:{default:""},closeOnClick:{type:Boolean,default:!0}},emits:["open","close","toggle"],setup(O,{expose:M,emit:F}){const k=O,c=F,u=p(!1);function g(){u.value=!u.value,c("toggle",u.value),u.value?c("open"):c("close")}function C(){u.value&&(u.value=!1,c("close"),c("toggle",!1))}function D(r){setTimeout(()=>{(!r.relatedTarget||!r.currentTarget?.contains(r.relatedTarget))&&C()},150)}function f(r){if(k.closeOnClick){const v=r.target;(v.classList.contains("dropdown-item")||v.closest(".dropdown-item"))&&C()}}function h(r){const v=r.target;r.currentTarget.contains(v)||C()}return U(()=>{document.addEventListener("click",h)}),ms(()=>{document.removeEventListener("click",h)}),M({close:C,open:()=>{u.value=!0,c("open"),c("toggle",!0)},toggle:g}),(r,v)=>(n(),l("div",{class:P(["custom-dropdown",{show:u.value}])},[e("button",{onClick:g,onBlur:D,class:P(["dropdown-toggle",r.buttonClass]),type:"button","aria-expanded":u.value},[I(r.$slots,"trigger",{},()=>[i(d(r.label),1)]),e("i",{class:P(["fas fa-chevron-down dropdown-icon",{rotated:u.value}])},null,2)],42,Ts),e("div",{class:P(["dropdown-menu",{show:u.value,[r.menuClass]:!0}]),onClick:f},[I(r.$slots,"default",{},void 0)],2)],2))}}),q=Y($s,[["__scopeId","data-v-9f9a5097"]]),Ls={class:"search-page"},Ds={class:"container py-5"},Ss={class:"row mb-5"},Ms={class:"col-12"},Es={class:"search-header text-center"},Bs={class:"lead text-muted mb-4"},Ps={class:"row justify-content-center"},qs={class:"col-lg-8 col-md-10"},Fs={class:"search-input-group"},Rs={class:"input-group input-group-lg"},As=["disabled"],js={key:0,class:"search-suggestions"},Ns={class:"list-group"},Os=["onClick"],Vs={class:"text-muted"},Hs={key:0},Is={class:"row mb-4"},zs={class:"col-12"},Ks={class:"search-stats d-flex justify-content-between align-items-center flex-wrap"},Qs={class:"search-info"},Us={class:"mb-1"},Ys={class:"text-muted"},Zs={class:"text-muted mb-0"},Ws={key:0},Gs={key:0,class:"search-sort"},Js={key:0,class:"row mb-4"},Xs={class:"col-12"},se={class:"search-filters card"},ee={class:"card-body"},te={class:"row align-items-center"},oe={class:"col-md-4"},ae=["onClick"],le={class:"badge bg-secondary ms-auto"},ne={class:"col-md-4"},ie=["onClick"],re={class:"badge bg-secondary ms-auto"},de={class:"col-md-4"},ce={key:0,class:"mt-3"},ue={key:1},ve={class:"row"},me={class:"card search-result-card h-100"},pe={class:"card-body"},fe={class:"row"},be={class:"col-md-8"},ge={class:"card-title mb-2"},he=["innerHTML"],_e={key:0,class:"badge bg-warning text-dark ms-2"},we=["innerHTML"],ye={class:"mb-2"},ke={class:"search-match-info"},Ce={class:"text-success"},xe={class:"col-md-4"},Te={class:"text-md-end"},$e={key:0,class:"mb-3"},Le=["src","alt"],De={class:"text-muted small mb-3"},Se={class:"mb-1"},Me={class:"mb-1"},Ee={key:0,class:"row mt-4"},Be={class:"col-12"},Pe={key:2,class:"text-center py-5"},qe={class:"text-muted mb-4"},Fe={class:"mt-4"},Re={key:1,class:"row"},Ae={class:"col-12"},je={class:"search-suggestions-section"},Ne={class:"row"},Oe={class:"col-md-6 mb-4"},Ve={class:"card"},He={class:"card-body"},Ie={class:"d-flex flex-wrap gap-2"},ze=["onClick"],Ke={class:"badge bg-secondary ms-1"},Qe={class:"col-md-6 mb-4"},Ue={class:"card"},Ye={class:"card-body"},Ze={class:"d-flex flex-wrap gap-2"},We=["onClick"],Ge={class:"badge bg-primary ms-1"},N=10,Je=Q({__name:"SearchPage",setup(O){const M=ps(),F=ys(),k=ks(),c=p(""),u=p(""),g=p([]),C=p(!1),D=p(0),f=p(1),h=p("relevance"),r=p(""),v=p(""),b=p(""),E=p(!1),R=p(),V=_(()=>{if(!c.value.trim()||c.value.length<2)return[];const o=c.value.toLowerCase(),s=new Set;return k.publishedPosts.forEach(a=>{a.title.toLowerCase().split(/\s+/).forEach(t=>{t.includes(o)&&t.length>2&&s.add(t)}),a.tags.forEach(t=>{t.toLowerCase().includes(o)&&s.add(t)}),a.categories.forEach(t=>{t.toLowerCase().includes(o)&&s.add(t)})}),Array.from(s).slice(0,5)}),Z=_(()=>[...k.tags].sort((o,s)=>s.count-o.count).slice(0,8)),W=_(()=>[...k.categories].sort((o,s)=>s.count-o.count).slice(0,6)),G=_(()=>{const o=new Map;return g.value.forEach(s=>{s.post.categories.forEach(a=>{o.set(a,(o.get(a)||0)+1)})}),Array.from(o.entries()).map(([s,a])=>({name:s,count:a})).sort((s,a)=>a.count-s.count)}),J=_(()=>{const o=new Map;return g.value.forEach(s=>{s.post.tags.forEach(a=>{o.set(a,(o.get(a)||0)+1)})}),Array.from(o.entries()).map(([s,a])=>({name:s,count:a})).sort((s,a)=>a.count-s.count)}),B=_(()=>{let o=[...g.value];if(r.value&&(o=o.filter(s=>s.post.categories.includes(r.value))),v.value&&(o=o.filter(s=>s.post.tags.includes(v.value))),b.value){const s=new Date,a=new Date;switch(b.value){case"week":a.setDate(s.getDate()-7);break;case"month":a.setMonth(s.getMonth()-1);break;case"year":a.setFullYear(s.getFullYear()-1);break}o=o.filter(t=>new Date(t.post.date)>=a)}switch(h.value){case"date-desc":o.sort((s,a)=>new Date(a.post.date).getTime()-new Date(s.post.date).getTime());break;case"date-asc":o.sort((s,a)=>new Date(s.post.date).getTime()-new Date(a.post.date).getTime());break;case"title-asc":o.sort((s,a)=>s.post.title.localeCompare(a.post.title));break;case"relevance":default:o.sort((s,a)=>a.score-s.score);break}return o}),H=_(()=>Math.ceil(B.value.length/N)),X=_(()=>{const o=(f.value-1)*N,s=o+N;return B.value.slice(o,s)}),ss=_(()=>r.value||v.value||b.value);function L(){if(!c.value.trim())return;const o=performance.now();u.value=c.value.trim(),g.value=k.searchPosts(u.value),C.value=!0,E.value=!1,D.value=Math.round(performance.now()-o),f.value=1,F.push({name:"Search",query:{q:u.value}})}function es(o){c.value=o,E.value=!1,L()}function ts(o){return k.searchPosts(o).length}function os(o){c.value=o,L()}function as(o){c.value=o,L()}function ls(){r.value="",v.value="",b.value="",f.value=1}function ns(){return{"":"所有时间",week:"最近一周",month:"最近一月",year:"最近一年"}[b.value]||"所有时间"}function is(){return{relevance:"相关性","date-desc":"最新发布","date-asc":"最早发布","title-asc":"标题 A-Z"}[h.value]||"相关性"}function rs(o){f.value=o,window.scrollTo({top:0,behavior:"smooth"})}function ds(o){return new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}function A(o){if(!u.value)return o;const s=new RegExp(`(${u.value})`,"gi");return o.replace(s,'<mark class="bg-warning">$1</mark>')}function cs(o){const s=u.value.toLowerCase(),a=o.post.content||o.post.excerpt;if(!a)return o.post.excerpt;const t=a.toLowerCase().indexOf(s);if(t===-1)return A(o.post.excerpt);const m=Math.max(0,t-50),j=Math.min(a.length,t+s.length+50);let S=a.slice(m,j);return m>0&&(S="..."+S),j<a.length&&(S=S+"..."),A(S)}function us(o){const s=[],a=u.value.toLowerCase();return o.post.title.toLowerCase().includes(a)&&s.push("标题"),o.post.excerpt.toLowerCase().includes(a)&&s.push("摘要"),o.post.content&&o.post.content.toLowerCase().includes(a)&&s.push("内容"),o.post.tags.some(t=>t.toLowerCase().includes(a))&&s.push("标签"),o.post.categories.some(t=>t.toLowerCase().includes(a))&&s.push("分类"),s.join(", ")||"其他"}function vs(o){return o.startsWith("http")?o:`/blog/${o}`}return z(c,o=>{E.value=o.length>=2}),z([r,v,b],()=>{f.value=1}),U(()=>{M.query.q&&(c.value=M.query.q,fs(()=>{L()})),R.value&&R.value.focus()}),(o,s)=>{const a=ws("router-link");return n(),l("div",Ls,[e("div",Ds,[e("div",Ss,[e("div",Ms,[e("div",Es,[s[16]||(s[16]=e("div",{class:"search-icon mx-auto mb-3"},[e("i",{class:"fas fa-search text-primary"})],-1)),s[17]||(s[17]=e("h1",{class:"display-5 fw-bold mb-3"},"搜索文章",-1)),e("p",Bs," 在 "+d(K(k).publishedPosts.length)+" 篇文章中搜索您感兴趣的内容 ",1),e("div",Ps,[e("div",qs,[e("div",Fs,[e("div",Rs,[s[14]||(s[14]=e("span",{class:"input-group-text border-end-0"},[e("i",{class:"fas fa-search text-muted"})],-1)),bs(e("input",{type:"text",class:"form-control border-start-0 ps-0",placeholder:"输入关键词搜索文章...","onUpdate:modelValue":s[0]||(s[0]=t=>c.value=t),onKeyup:hs(L,["enter"]),ref_key:"searchInput",ref:R},null,544),[[gs,c.value]]),e("button",{class:"btn btn-primary",type:"button",onClick:L,disabled:!c.value.trim()}," 搜索 ",8,As)]),E.value&&V.value.length>0?(n(),l("div",js,[e("div",Ns,[(n(!0),l(x,null,T(V.value,(t,m)=>(n(),l("button",{key:m,type:"button",class:"list-group-item list-group-item-action d-flex justify-content-between align-items-center",onClick:j=>es(t)},[e("span",null,[s[15]||(s[15]=e("i",{class:"fas fa-search text-muted me-2"},null,-1)),i(" "+d(t),1)]),e("small",Vs,d(ts(t))+" 篇",1)],8,Os))),128))])])):w("",!0)])])])])])]),C.value?(n(),l("div",Hs,[e("div",Is,[e("div",zs,[e("div",Ks,[e("div",Qs,[e("h5",Us,[s[18]||(s[18]=i(" 搜索结果 ",-1)),e("span",Ys,'"'+d(u.value)+'"',1)]),e("p",Zs,[i(" 找到 "+d(g.value.length)+" 篇相关文章 ",1),D.value>0?(n(),l("span",Ws,"(用时 "+d(D.value)+"ms)",1)):w("",!0)])]),g.value.length>0?(n(),l("div",Gs,[y(q,{label:is(),"button-class":"btn btn-outline-secondary btn-sm"},{default:$(()=>[e("div",{class:"dropdown-item",onClick:s[1]||(s[1]=t=>h.value="relevance")},s[19]||(s[19]=[e("i",{class:"fas fa-star me-2"},null,-1),i(" 相关性 ",-1)])),e("div",{class:"dropdown-item",onClick:s[2]||(s[2]=t=>h.value="date-desc")},s[20]||(s[20]=[e("i",{class:"fas fa-calendar-alt me-2"},null,-1),i(" 最新发布 ",-1)])),e("div",{class:"dropdown-item",onClick:s[3]||(s[3]=t=>h.value="date-asc")},s[21]||(s[21]=[e("i",{class:"fas fa-calendar me-2"},null,-1),i(" 最早发布 ",-1)])),e("div",{class:"dropdown-item",onClick:s[4]||(s[4]=t=>h.value="title-asc")},s[22]||(s[22]=[e("i",{class:"fas fa-sort-alpha-down me-2"},null,-1),i(" 标题 A-Z ",-1)]))]),_:1},8,["label"])])):w("",!0)])])]),g.value.length>0?(n(),l("div",Js,[e("div",Xs,[e("div",se,[e("div",ee,[e("div",te,[e("div",oe,[s[26]||(s[26]=e("label",{class:"form-label mb-2"},"按分类筛选：",-1)),y(q,{label:r.value||"所有分类","button-class":"btn btn-outline-secondary w-100",onClose:s[6]||(s[6]=t=>f.value=1)},{default:$(()=>[e("div",{class:"dropdown-item",onClick:s[5]||(s[5]=t=>r.value="")},s[23]||(s[23]=[e("i",{class:"fas fa-folder me-2"},null,-1),i(" 所有分类 ",-1)])),s[25]||(s[25]=e("div",{class:"dropdown-divider"},null,-1)),(n(!0),l(x,null,T(G.value,t=>(n(),l("div",{key:t.name,class:"dropdown-item",onClick:m=>r.value=t.name},[s[24]||(s[24]=e("i",{class:"fas fa-folder me-2"},null,-1)),i(" "+d(t.name)+" ",1),e("span",le,d(t.count),1)],8,ae))),128))]),_:1,__:[25]},8,["label"])]),e("div",ne,[s[30]||(s[30]=e("label",{class:"form-label mb-2"},"按标签筛选：",-1)),y(q,{label:v.value||"所有标签","button-class":"btn btn-outline-secondary w-100",onClose:s[8]||(s[8]=t=>f.value=1)},{default:$(()=>[e("div",{class:"dropdown-item",onClick:s[7]||(s[7]=t=>v.value="")},s[27]||(s[27]=[e("i",{class:"fas fa-tags me-2"},null,-1),i(" 所有标签 ",-1)])),s[29]||(s[29]=e("div",{class:"dropdown-divider"},null,-1)),(n(!0),l(x,null,T(J.value,t=>(n(),l("div",{key:t.name,class:"dropdown-item",onClick:m=>v.value=t.name},[s[28]||(s[28]=e("i",{class:"fas fa-tag me-2"},null,-1)),i(" #"+d(t.name)+" ",1),e("span",re,d(t.count),1)],8,ie))),128))]),_:1,__:[29]},8,["label"])]),e("div",de,[s[36]||(s[36]=e("label",{class:"form-label mb-2"},"发布时间：",-1)),y(q,{label:ns(),"button-class":"btn btn-outline-secondary w-100",onClose:s[13]||(s[13]=t=>f.value=1)},{default:$(()=>[e("div",{class:"dropdown-item",onClick:s[9]||(s[9]=t=>b.value="")},s[31]||(s[31]=[e("i",{class:"fas fa-calendar me-2"},null,-1),i(" 所有时间 ",-1)])),s[35]||(s[35]=e("div",{class:"dropdown-divider"},null,-1)),e("div",{class:"dropdown-item",onClick:s[10]||(s[10]=t=>b.value="week")},s[32]||(s[32]=[e("i",{class:"fas fa-calendar-week me-2"},null,-1),i(" 最近一周 ",-1)])),e("div",{class:"dropdown-item",onClick:s[11]||(s[11]=t=>b.value="month")},s[33]||(s[33]=[e("i",{class:"fas fa-calendar-alt me-2"},null,-1),i(" 最近一月 ",-1)])),e("div",{class:"dropdown-item",onClick:s[12]||(s[12]=t=>b.value="year")},s[34]||(s[34]=[e("i",{class:"fas fa-calendar-check me-2"},null,-1),i(" 最近一年 ",-1)]))]),_:1,__:[35]},8,["label"])])]),ss.value?(n(),l("div",ce,[e("button",{class:"btn btn-outline-secondary btn-sm",onClick:ls},s[37]||(s[37]=[e("i",{class:"fas fa-times me-1"},null,-1),i(" 清除筛选 ",-1)]))])):w("",!0)])])])])):w("",!0),B.value.length>0?(n(),l("div",ue,[e("div",ve,[(n(!0),l(x,null,T(X.value,t=>(n(),l("div",{key:t.post.id,class:"col-12 mb-4"},[e("div",me,[e("div",pe,[e("div",fe,[e("div",be,[e("h5",ge,[y(a,{to:`/post/${t.post.slug}`,class:"text-decoration-none",style:{color:"var(--text-primary)"}},{default:$(()=>[e("span",{innerHTML:A(t.post.title)},null,8,he)]),_:2},1032,["to"]),t.post.featured?(n(),l("span",_e,s[38]||(s[38]=[e("i",{class:"fas fa-star"},null,-1),i(" 精选 ",-1)]))):w("",!0)]),e("p",{class:"card-text text-muted mb-3",innerHTML:cs(t)},null,8,we),e("div",ye,[(n(!0),l(x,null,T(t.post.categories,m=>(n(),l("span",{key:m,class:"badge bg-primary me-1 mb-1"},d(m),1))),128)),(n(!0),l(x,null,T(t.post.tags.slice(0,3),m=>(n(),l("span",{key:m,class:"badge bg-secondary me-1 mb-1"}," #"+d(m),1))),128))]),e("div",ke,[e("small",Ce,[s[39]||(s[39]=e("i",{class:"fas fa-check-circle me-1"},null,-1)),i(" 匹配度: "+d(Math.round(t.score*100))+"% ",1),s[40]||(s[40]=e("span",{class:"mx-2"},"|",-1)),i(" 匹配字段: "+d(us(t)),1)])])]),e("div",xe,[e("div",Te,[t.post.image?(n(),l("div",$e,[e("img",{src:vs(t.post.image),alt:t.post.title,class:"img-fluid rounded search-result-image",style:{"max-height":"120px","object-fit":"cover"}},null,8,Le)])):w("",!0),e("div",De,[e("div",Se,[s[41]||(s[41]=e("i",{class:"fas fa-user me-1"},null,-1)),i(" "+d(t.post.author),1)]),e("div",Me,[s[42]||(s[42]=e("i",{class:"fas fa-calendar me-1"},null,-1)),i(" "+d(ds(t.post.date)),1)]),e("div",null,[s[43]||(s[43]=e("i",{class:"fas fa-clock me-1"},null,-1)),i(" "+d(t.post.readTime||K(Cs)(t.post.content))+" 分钟阅读 ",1)])]),y(a,{to:`/post/${t.post.slug}`,class:"btn btn-outline-primary btn-sm"},{default:$(()=>s[44]||(s[44]=[i(" 阅读全文 ",-1),e("i",{class:"fas fa-arrow-right ms-1"},null,-1)])),_:2,__:[44]},1032,["to"])])])])])])]))),128))]),H.value>1?(n(),l("div",Ee,[e("div",Be,[y(xs,{"current-page":f.value,"total-pages":H.value,total:B.value.length,onPageChange:rs},null,8,["current-page","total-pages","total"])])])):w("",!0)])):C.value?(n(),l("div",Pe,[s[47]||(s[47]=e("i",{class:"fas fa-search text-muted",style:{"font-size":"4rem"}},null,-1)),s[48]||(s[48]=e("h3",{class:"mt-3 text-muted"},"未找到相关文章",-1)),e("p",qe,' 没有找到包含 "'+d(u.value)+'" 的文章 ',1),s[49]||(s[49]=_s('<div class="search-suggestions-empty" data-v-c8bb00a1><p class="mb-3" data-v-c8bb00a1>您可以尝试：</p><ul class="list-unstyled" data-v-c8bb00a1><li class="mb-2" data-v-c8bb00a1>• 检查拼写是否正确</li><li class="mb-2" data-v-c8bb00a1>• 尝试使用更通用的关键词</li><li class="mb-2" data-v-c8bb00a1>• 减少搜索词的数量</li><li class="mb-2" data-v-c8bb00a1>• 浏览所有文章或分类</li></ul></div>',1)),e("div",Fe,[y(a,{to:"/posts",class:"btn btn-primary me-3"},{default:$(()=>s[45]||(s[45]=[e("i",{class:"fas fa-book-open me-2"},null,-1),i(" 浏览所有文章 ",-1)])),_:1,__:[45]}),y(a,{to:"/categories",class:"btn btn-outline-primary"},{default:$(()=>s[46]||(s[46]=[e("i",{class:"fas fa-folder me-2"},null,-1),i(" 浏览分类 ",-1)])),_:1,__:[46]})])])):w("",!0)])):(n(),l("div",Re,[e("div",Ae,[e("div",je,[s[52]||(s[52]=e("h4",{class:"mb-4 text-center"},"热门搜索",-1)),e("div",Ne,[e("div",Oe,[e("div",Ve,[e("div",He,[s[50]||(s[50]=e("h6",{class:"card-title"},[e("i",{class:"fas fa-fire text-danger me-2"}),i(" 热门标签 ")],-1)),e("div",Ie,[(n(!0),l(x,null,T(Z.value,t=>(n(),l("button",{key:t.name,class:"btn btn-outline-secondary btn-sm",onClick:m=>os(t.name)},[i(" #"+d(t.name)+" ",1),e("span",Ke,d(t.count),1)],8,ze))),128))])])])]),e("div",Qe,[e("div",Ue,[e("div",Ye,[s[51]||(s[51]=e("h6",{class:"card-title"},[e("i",{class:"fas fa-folder text-primary me-2"}),i(" 热门分类 ")],-1)),e("div",Ze,[(n(!0),l(x,null,T(W.value,t=>(n(),l("button",{key:t.name,class:"btn btn-outline-primary btn-sm",onClick:m=>as(t.name)},[i(d(t.name)+" ",1),e("span",Ge,d(t.count),1)],8,We))),128))])])])])])])])]))])])}}}),nt=Y(Je,[["__scopeId","data-v-c8bb00a1"]]);export{nt as default};
