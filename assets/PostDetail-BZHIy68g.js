import{j as M,q as i,s as l,D as E,u as t,B as f,P as F,z as p,F as I,C as $,G as w,r as _,k as N,l as W,y as g,d as H,w as P,v as B,x as T,p as G,H as Y,n as J}from"./vue-DoCjM5oa.js";import{_ as D,u as K,e as Q}from"./index-D-_Qqt0N.js";import{P as X}from"./PostCard-BR9994_e.js";import"./libs--DbO3urw.js";import"./markdown--zrfzkwQ.js";import"./highlight-CjIDkcmk.js";import"./katex-734Zlhpu.js";const Z=["href"],tt={key:0,class:"toc-children"},et=M({__name:"TocItem",props:{item:{},activeId:{}},emits:["click"],setup(S){return(r,c)=>(l(),i("li",{class:E(["toc-item",`level-${r.item.level}`])},[t("a",{href:`#${r.item.id}`,class:E([{active:r.activeId===r.item.id},"toc-link"]),onClick:c[0]||(c[0]=F(v=>r.$emit("click",r.item.id),["prevent"]))},p(r.item.text),11,Z),r.item.children&&r.item.children.length>0?(l(),i("ul",tt,[(l(!0),i(I,null,$(r.item.children,v=>(l(),w(A,{key:v.id,item:v,"active-id":r.activeId,onClick:c[1]||(c[1]=o=>r.$emit("click",o))},null,8,["item","active-id"]))),128))])):f("",!0)],2))}}),A=D(et,[["__scopeId","data-v-905997c1"]]),st={key:0,class:"table-of-contents"},ot={class:"toc-header"},nt=["aria-expanded"],lt={class:"toc-list"},at=M({__name:"TableOfContents",props:{tocItems:{}},setup(S){const r=_(""),c=_(!1);function v(){c.value=!c.value}function o(a){const d=document.getElementById(a);if(d){const y=d.offsetTop-80;window.scrollTo({top:y,behavior:"smooth"}),window.history.replaceState(null,"",`#${a}`)}}function b(){const a=document.querySelectorAll(".post-content h1[id], .post-content h2[id], .post-content h3[id], .post-content h4[id], .post-content h5[id], .post-content h6[id]");let d="";const u=window.pageYOffset||document.documentElement.scrollTop;for(let y=a.length-1;y>=0;y--){const k=a[y],C=k.offsetTop-100;if(u>=C){d=k.id;break}}r.value=d}function x(a,d){let u;return function(){u||(a(),u=!0,setTimeout(()=>u=!1,d))}}const h=x(b,100);return N(()=>{if(window.location.hash){const a=decodeURIComponent(window.location.hash.slice(1));setTimeout(()=>o(a),500)}window.addEventListener("scroll",h),b()}),W(()=>{window.removeEventListener("scroll",h)}),(a,d)=>a.tocItems.length>0?(l(),i("div",st,[t("div",ot,[d[0]||(d[0]=t("h5",{class:"toc-title"},[t("i",{class:"fas fa-list me-2"}),g(" 目录 ")],-1)),t("button",{class:"btn btn-sm btn-outline-secondary toc-toggle",onClick:v,"aria-expanded":!c.value},[t("i",{class:E(c.value?"fas fa-chevron-down":"fas fa-chevron-up")},null,2)],8,nt)]),t("nav",{class:E(["toc-nav",{collapsed:c.value}])},[t("ul",lt,[(l(!0),i(I,null,$(a.tocItems,u=>(l(),w(A,{key:u.id,item:u,"active-id":r.value,onClick:o},null,8,["item","active-id"]))),128))])],2)])):f("",!0)}}),it=D(at,[["__scopeId","data-v-13b5de41"]]),rt={class:"post-detail"},ct={key:0,class:"container py-5"},dt={key:1,class:"container py-5"},ut={class:"row justify-content-center"},mt={class:"col-lg-8"},vt={class:"text-center"},pt={class:"mb-4"},ft={key:2,class:"container py-5"},gt={class:"row mb-5"},ht={class:"post-article"},yt={class:"mb-4"},_t={class:"post-header mb-4"},bt={class:"display-5 fw-bold mb-3"},kt={key:0,class:"mb-3"},wt={class:"post-meta d-flex flex-wrap align-items-center gap-3 text-muted mb-4"},xt={class:"d-flex align-items-center"},Ct={class:"d-flex align-items-center"},Tt={key:0,class:"d-flex align-items-center"},It={class:"post-taxonomy mb-4"},$t={class:"mb-2"},Et={key:0,class:"post-image mb-5"},Lt=["src","alt"],St=["innerHTML"],Ht={key:0,class:"toc-sidebar"},Pt={key:0,class:"row mt-5"},Bt={class:"col-12"},Mt={class:"related-posts"},Dt={class:"row"},Nt={class:"row mt-5"},At={class:"col-12"},jt={class:"post-navigation"},qt={class:"d-flex justify-content-between"},zt=M({__name:"PostDetail",props:{slug:{}},setup(S){const r=S,c=Y(),v=K(),o=_(null),b=_([]),x=_(!0),h=_(""),a=_([]),d=async()=>{try{x.value=!0;const s=r.slug||c.params.slug,e=await v.getPostBySlugWithContent(s);if(!e){h.value="文章不存在";return}o.value=e,b.value=v.getRelatedPosts(e,3),e.content&&(a.value=Q(e.content))}catch(s){h.value="加载文章失败",console.error("Error loading post:",s)}finally{x.value=!1}},u=H(()=>!o.value||!o.value.content?"":v.renderMarkdown(o.value.content)),y=()=>{J(()=>{document.querySelectorAll(".post-content pre").forEach(e=>{if(e.querySelector(".code-copy-btn"))return;const m=e.textContent||"";if(m.trim()){const n=document.createElement("button");n.className="code-copy-btn",n.innerHTML='<i class="fas fa-copy"></i> 复制',n.title="复制代码";const R=async()=>{try{await navigator.clipboard.writeText(m),n.innerHTML='<i class="fas fa-check"></i> 已复制',n.style.color="var(--success)",setTimeout(()=>{n.innerHTML='<i class="fas fa-copy"></i> 复制',n.style.color="var(--text-secondary)"},2e3)}catch(U){console.error("复制失败:",U);const L=document.createElement("textarea");L.value=m,document.body.appendChild(L),L.select(),document.execCommand("copy"),document.body.removeChild(L),n.innerHTML='<i class="fas fa-check"></i> 已复制',n.style.color="var(--success)",setTimeout(()=>{n.innerHTML='<i class="fas fa-copy"></i> 复制',n.style.color="var(--text-secondary)"},2e3)}};n.addEventListener("click",R),e.style.position="relative",e.appendChild(n)}})})},k=H(()=>{if(!o.value)return null;const s=v.publishedPosts,e=s.findIndex(m=>m.id===o.value.id);return e>0?s[e-1]:null}),C=H(()=>{if(!o.value)return null;const s=v.publishedPosts,e=s.findIndex(m=>m.id===o.value.id);return e<s.length-1?s[e+1]:null});function j(s){return s.toLowerCase().replace(/\s+/g,"-")}function q(s){return s.toLowerCase().replace(/\s+/g,"-")}function z(s){return new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}function V(s){return s.startsWith("http")?s:`/blog/${s}`}function O(s){const e=s.target;e.style.display="none"}return P(()=>c.params.slug,()=>{d()}),P(o,s=>{s&&(document.title=`${s.title} - ${v.config.site.title}`)},{immediate:!0}),P(u,()=>{u.value&&y()}),N(()=>{d(),window.scrollTo({top:0,behavior:"smooth"})}),(s,e)=>{const m=G("router-link");return l(),i("div",rt,[x.value?(l(),i("div",ct,e[1]||(e[1]=[t("div",{class:"row justify-content-center"},[t("div",{class:"col-lg-8"},[t("div",{class:"text-center"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"加载中...")]),t("p",{class:"mt-3 text-muted"},"正在加载文章内容...")])])],-1)]))):h.value?(l(),i("div",dt,[t("div",ut,[t("div",mt,[t("div",vt,[e[3]||(e[3]=t("h1",{class:"display-4 text-muted"},"404",-1)),t("h2",pt,p(h.value),1),e[4]||(e[4]=t("p",{class:"text-muted mb-4"},"抱歉，无法加载文章内容。",-1)),B(m,{to:"/posts",class:"btn btn-primary"},{default:T(()=>e[2]||(e[2]=[t("i",{class:"fas fa-arrow-left me-2"},null,-1),g(" 返回文章列表 ",-1)])),_:1,__:[2]})])])])])):o.value?(l(),i("div",ft,[t("div",gt,[t("div",{class:E(["col-lg-8 col-xl-9",{"mx-auto":a.value.length===0,"pe-lg-5":a.value.length>0}])},[t("article",ht,[t("div",yt,[t("button",{onClick:e[0]||(e[0]=n=>s.$router.go(-1)),class:"btn btn-outline-secondary btn-sm"},e[5]||(e[5]=[t("i",{class:"fas fa-arrow-left me-2"},null,-1),g(" 返回 ",-1)]))]),t("header",_t,[t("h1",bt,p(o.value.title),1),o.value.featured?(l(),i("div",kt,e[6]||(e[6]=[t("span",{class:"badge bg-warning text-dark fs-6 py-2 px-3"},[t("i",{class:"fas fa-star me-1"}),g(" 精选文章 ")],-1)]))):f("",!0),t("div",wt,[t("div",xt,[e[7]||(e[7]=t("i",{class:"fas fa-user me-2"},null,-1)),t("span",null,p(o.value.author),1)]),t("div",Ct,[e[8]||(e[8]=t("i",{class:"fas fa-calendar me-2"},null,-1)),t("span",null,p(z(o.value.date)),1)]),o.value.readTime?(l(),i("div",Tt,[e[9]||(e[9]=t("i",{class:"fas fa-clock me-2"},null,-1)),t("span",null,p(o.value.readTime)+" 分钟阅读",1)])):f("",!0)]),t("div",It,[t("div",$t,[e[10]||(e[10]=t("span",{class:"me-2"},"分类：",-1)),(l(!0),i(I,null,$(o.value.categories,n=>(l(),w(m,{key:n,to:`/category/${j(n)}`,class:"badge bg-primary text-decoration-none me-1"},{default:T(()=>[g(p(n),1)]),_:2},1032,["to"]))),128))]),t("div",null,[e[11]||(e[11]=t("span",{class:"me-2"},"标签：",-1)),(l(!0),i(I,null,$(o.value.tags,n=>(l(),w(m,{key:n,to:`/tag/${q(n)}`,class:"badge bg-secondary text-decoration-none me-1 mb-1"},{default:T(()=>[g(" #"+p(n),1)]),_:2},1032,["to"]))),128))])])]),o.value.image?(l(),i("div",Et,[t("img",{src:V(o.value.image),alt:o.value.title,class:"img-fluid rounded shadow",onError:O,loading:"lazy"},null,40,Lt)])):f("",!0),t("div",{class:"post-content",innerHTML:u.value},null,8,St)])],2),a.value.length>0?(l(),i("div",Ht,[B(it,{"toc-items":a.value},null,8,["toc-items"])])):f("",!0)]),b.value.length>0?(l(),i("div",Pt,[t("div",Bt,[t("section",Mt,[e[12]||(e[12]=t("h3",{class:"h4 mb-4"},[t("i",{class:"fas fa-lightbulb text-warning me-2"}),g(" 相关文章 ")],-1)),t("div",Dt,[(l(!0),i(I,null,$(b.value,n=>(l(),i("div",{key:n.id,class:"col-lg-4 col-md-6 mb-4"},[B(X,{post:n},null,8,["post"])]))),128))])])])])):f("",!0),t("div",Nt,[t("div",At,[t("nav",jt,[t("div",qt,[t("div",null,[k.value?(l(),w(m,{key:0,to:`/post/${k.value.slug}`,class:"btn btn-outline-primary"},{default:T(()=>[e[13]||(e[13]=t("i",{class:"fas fa-chevron-left me-2"},null,-1)),g(" 上一篇："+p(k.value.title),1)]),_:1,__:[13]},8,["to"])):f("",!0)]),t("div",null,[C.value?(l(),w(m,{key:0,to:`/post/${C.value.slug}`,class:"btn btn-outline-primary"},{default:T(()=>[g(" 下一篇："+p(C.value.title)+" ",1),e[14]||(e[14]=t("i",{class:"fas fa-chevron-right ms-2"},null,-1))]),_:1,__:[14]},8,["to"])):f("",!0)])])])])])])):f("",!0)])}}}),Yt=D(zt,[["__scopeId","data-v-8b448442"]]);export{Yt as default};
