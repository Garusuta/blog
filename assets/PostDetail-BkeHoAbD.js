import{j as B,q as r,s as l,D as E,u as t,B as p,P as W,z as v,F as I,C as $,G as w,A as F,Q as G,r as y,k as D,l as Q,y as f,d as S,w as H,v as M,x,p as Y,H as J,n as K}from"./vue-BfKCsOgC.js";import{a as X,_ as A,u as Z,e as tt}from"./index-Bg6PUqXx.js";import{P as et}from"./PostCard-BE22oXOP.js";import"./libs-BNXOlkbY.js";import"./markdown--zrfzkwQ.js";import"./highlight-CjIDkcmk.js";import"./katex-734Zlhpu.js";const st=["href"],ot={key:0,class:"toc-children"},nt=B({__name:"TocItem",props:{item:{},activeId:{}},emits:["click"],setup(P){const b=G(()=>X(()=>Promise.resolve().then(()=>lt),void 0));return(a,c)=>(l(),r("li",{class:E(["toc-item",`level-${a.item.level}`])},[t("a",{href:`#${a.item.id}`,class:E([{active:a.activeId===a.item.id},"toc-link"]),onClick:c[0]||(c[0]=W(o=>a.$emit("click",a.item.id),["prevent"]))},v(a.item.text),11,st),a.item.children&&a.item.children.length>0?(l(),r("ul",ot,[(l(!0),r(I,null,$(a.item.children,o=>(l(),w(F(b),{key:o.id,item:o,"active-id":a.activeId,onClick:c[1]||(c[1]=_=>a.$emit("click",_))},null,8,["item","active-id"]))),128))])):p("",!0)],2))}}),j=A(nt,[["__scopeId","data-v-9817f6ed"]]),lt=Object.freeze(Object.defineProperty({__proto__:null,default:j},Symbol.toStringTag,{value:"Module"})),at={key:0,class:"table-of-contents"},it={class:"toc-header"},rt=["aria-expanded"],ct={class:"toc-list"},dt=B({__name:"TableOfContents",props:{tocItems:{}},setup(P){const b=y(""),a=y(!1);function c(){a.value=!a.value}function o(i){const d=document.getElementById(i);if(d){const h=d.offsetTop-80;window.scrollTo({top:h,behavior:"smooth"}),window.history.replaceState(null,"",`#${i}`)}}function _(){const i=document.querySelectorAll(".post-content h1[id], .post-content h2[id], .post-content h3[id], .post-content h4[id], .post-content h5[id], .post-content h6[id]");let d="";const u=window.pageYOffset||document.documentElement.scrollTop;for(let h=i.length-1;h>=0;h--){const k=i[h],C=k.offsetTop-100;if(u>=C){d=k.id;break}}b.value=d}function T(i,d){let u;return function(){u||(i(),u=!0,setTimeout(()=>u=!1,d))}}const g=T(_,100);return D(()=>{if(window.location.hash){const i=decodeURIComponent(window.location.hash.slice(1));setTimeout(()=>o(i),500)}window.addEventListener("scroll",g),_()}),Q(()=>{window.removeEventListener("scroll",g)}),(i,d)=>i.tocItems.length>0?(l(),r("div",at,[t("div",it,[d[0]||(d[0]=t("h5",{class:"toc-title"},[t("i",{class:"fas fa-list me-2"}),f(" 目录 ")],-1)),t("button",{class:"btn btn-sm btn-outline-secondary toc-toggle",onClick:c,"aria-expanded":!a.value},[t("i",{class:E(a.value?"fas fa-chevron-down":"fas fa-chevron-up")},null,2)],8,rt)]),t("nav",{class:E(["toc-nav",{collapsed:a.value}])},[t("ul",ct,[(l(!0),r(I,null,$(i.tocItems,u=>(l(),w(j,{key:u.id,item:u,"active-id":b.value,onClick:o},null,8,["item","active-id"]))),128))])],2)])):p("",!0)}}),ut=A(dt,[["__scopeId","data-v-13b5de41"]]),mt={class:"post-detail"},vt={key:0,class:"container py-5"},pt={key:1,class:"container py-5"},ft={class:"row justify-content-center"},_t={class:"col-lg-8"},gt={class:"text-center"},ht={class:"mb-4"},yt={key:2,class:"container py-5"},bt={class:"row mb-5"},kt={class:"post-article"},wt={class:"mb-4"},Tt={class:"post-header mb-4"},Ct={class:"display-5 fw-bold mb-3"},xt={key:0,class:"mb-3"},It={class:"post-meta d-flex flex-wrap align-items-center gap-3 text-muted mb-4"},$t={class:"d-flex align-items-center"},Et={class:"d-flex align-items-center"},Lt={key:0,class:"d-flex align-items-center"},Pt={class:"post-taxonomy mb-4"},St={class:"mb-2"},Ht={key:0,class:"post-image mb-5"},Mt=["src","alt"],Bt=["innerHTML"],At={key:0,class:"toc-sidebar"},Dt={key:0,class:"row mt-5"},jt={class:"col-12"},Nt={class:"related-posts"},Ot={class:"row"},zt={class:"row mt-5"},Vt={class:"col-12"},qt={class:"post-navigation"},Rt={class:"d-flex justify-content-between"},Ut=B({__name:"PostDetail",props:{slug:{}},setup(P){const b=P,a=J(),c=Z(),o=y(null),_=y([]),T=y(!0),g=y(""),i=y([]),d=async()=>{try{T.value=!0;const s=b.slug||a.params.slug,e=await c.getPostBySlugWithContent(s);if(!e){g.value="文章不存在";return}o.value=e,_.value=c.getRelatedPosts(e,3),e.content&&(i.value=tt(e.content))}catch(s){g.value="加载文章失败",console.error("Error loading post:",s)}finally{T.value=!1}},u=S(()=>!o.value||!o.value.content?"":c.renderMarkdown(o.value.content)),h=()=>{K(()=>{document.querySelectorAll(".post-content pre").forEach(e=>{if(e.querySelector(".code-copy-btn"))return;const m=e.textContent||"";if(m.trim()){const n=document.createElement("button");n.className="code-copy-btn",n.innerHTML='<i class="fas fa-copy"></i> 复制',n.title="复制代码";const R=async()=>{try{await navigator.clipboard.writeText(m),n.innerHTML='<i class="fas fa-check"></i> 已复制',n.style.color="var(--success)",setTimeout(()=>{n.innerHTML='<i class="fas fa-copy"></i> 复制',n.style.color="var(--text-secondary)"},2e3)}catch(U){console.error("复制失败:",U);const L=document.createElement("textarea");L.value=m,document.body.appendChild(L),L.select(),document.execCommand("copy"),document.body.removeChild(L),n.innerHTML='<i class="fas fa-check"></i> 已复制',n.style.color="var(--success)",setTimeout(()=>{n.innerHTML='<i class="fas fa-copy"></i> 复制',n.style.color="var(--text-secondary)"},2e3)}};n.addEventListener("click",R),e.style.position="relative",e.appendChild(n)}})})},k=S(()=>{if(!o.value)return null;const s=c.publishedPosts,e=s.findIndex(m=>m.id===o.value.id);return e>0?s[e-1]:null}),C=S(()=>{if(!o.value)return null;const s=c.publishedPosts,e=s.findIndex(m=>m.id===o.value.id);return e<s.length-1?s[e+1]:null});function N(s){return s.toLowerCase().replace(/\s+/g,"-")}function O(s){return s.toLowerCase().replace(/\s+/g,"-")}function z(s){return new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}function V(s){return s.startsWith("http")||s.startsWith("/")?s:`/blog/${s}`}function q(s){const e=s.target;e.style.display="none"}return H(()=>a.params.slug,()=>{d()}),H(o,s=>{s&&(document.title=`${s.title} - ${c.config.site.title}`)},{immediate:!0}),H(u,()=>{u.value&&h()}),D(()=>{d(),window.scrollTo({top:0,behavior:"smooth"})}),(s,e)=>{const m=Y("router-link");return l(),r("div",mt,[T.value?(l(),r("div",vt,e[1]||(e[1]=[t("div",{class:"row justify-content-center"},[t("div",{class:"col-lg-8"},[t("div",{class:"text-center"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"加载中...")]),t("p",{class:"mt-3 text-muted"},"正在加载文章内容...")])])],-1)]))):g.value?(l(),r("div",pt,[t("div",ft,[t("div",_t,[t("div",gt,[e[3]||(e[3]=t("h1",{class:"display-4 text-muted"},"404",-1)),t("h2",ht,v(g.value),1),e[4]||(e[4]=t("p",{class:"text-muted mb-4"},"抱歉，无法加载文章内容。",-1)),M(m,{to:"/posts",class:"btn btn-primary"},{default:x(()=>e[2]||(e[2]=[t("i",{class:"fas fa-arrow-left me-2"},null,-1),f(" 返回文章列表 ",-1)])),_:1,__:[2]})])])])])):o.value?(l(),r("div",yt,[t("div",bt,[t("div",{class:E(["col-lg-8 col-xl-9",{"mx-auto":i.value.length===0,"pe-lg-5":i.value.length>0}])},[t("article",kt,[t("div",wt,[t("button",{onClick:e[0]||(e[0]=n=>s.$router.go(-1)),class:"btn btn-outline-secondary btn-sm"},e[5]||(e[5]=[t("i",{class:"fas fa-arrow-left me-2"},null,-1),f(" 返回 ",-1)]))]),t("header",Tt,[t("h1",Ct,v(o.value.title),1),o.value.featured?(l(),r("div",xt,e[6]||(e[6]=[t("span",{class:"badge bg-warning text-dark fs-6 py-2 px-3"},[t("i",{class:"fas fa-star me-1"}),f(" 精选文章 ")],-1)]))):p("",!0),t("div",It,[t("div",$t,[e[7]||(e[7]=t("i",{class:"fas fa-user me-2"},null,-1)),t("span",null,v(o.value.author),1)]),t("div",Et,[e[8]||(e[8]=t("i",{class:"fas fa-calendar me-2"},null,-1)),t("span",null,v(z(o.value.date)),1)]),o.value.readTime?(l(),r("div",Lt,[e[9]||(e[9]=t("i",{class:"fas fa-clock me-2"},null,-1)),t("span",null,v(o.value.readTime)+" 分钟阅读",1)])):p("",!0)]),t("div",Pt,[t("div",St,[e[10]||(e[10]=t("span",{class:"me-2"},"分类：",-1)),(l(!0),r(I,null,$(o.value.categories,n=>(l(),w(m,{key:n,to:`/category/${N(n)}`,class:"badge bg-primary text-decoration-none me-1"},{default:x(()=>[f(v(n),1)]),_:2},1032,["to"]))),128))]),t("div",null,[e[11]||(e[11]=t("span",{class:"me-2"},"标签：",-1)),(l(!0),r(I,null,$(o.value.tags,n=>(l(),w(m,{key:n,to:`/tag/${O(n)}`,class:"badge bg-secondary text-decoration-none me-1 mb-1"},{default:x(()=>[f(" #"+v(n),1)]),_:2},1032,["to"]))),128))])])]),o.value.image?(l(),r("div",Ht,[t("img",{src:V(o.value.image),alt:o.value.title,class:"img-fluid rounded shadow",onError:q,loading:"lazy"},null,40,Mt)])):p("",!0),t("div",{class:"post-content",innerHTML:u.value},null,8,Bt)])],2),i.value.length>0?(l(),r("div",At,[M(ut,{"toc-items":i.value},null,8,["toc-items"])])):p("",!0)]),_.value.length>0?(l(),r("div",Dt,[t("div",jt,[t("section",Nt,[e[12]||(e[12]=t("h3",{class:"h4 mb-4"},[t("i",{class:"fas fa-lightbulb text-warning me-2"}),f(" 相关文章 ")],-1)),t("div",Ot,[(l(!0),r(I,null,$(_.value,n=>(l(),r("div",{key:n.id,class:"col-lg-4 col-md-6 mb-4"},[M(et,{post:n},null,8,["post"])]))),128))])])])])):p("",!0),t("div",zt,[t("div",Vt,[t("nav",qt,[t("div",Rt,[t("div",null,[k.value?(l(),w(m,{key:0,to:`/post/${k.value.slug}`,class:"btn btn-outline-primary"},{default:x(()=>[e[13]||(e[13]=t("i",{class:"fas fa-chevron-left me-2"},null,-1)),f(" 上一篇："+v(k.value.title),1)]),_:1,__:[13]},8,["to"])):p("",!0)]),t("div",null,[C.value?(l(),w(m,{key:0,to:`/post/${C.value.slug}`,class:"btn btn-outline-primary"},{default:x(()=>[f(" 下一篇："+v(C.value.title)+" ",1),e[14]||(e[14]=t("i",{class:"fas fa-chevron-right ms-2"},null,-1))]),_:1,__:[14]},8,["to"])):p("",!0)])])])])])])):p("",!0)])}}}),Xt=A(Ut,[["__scopeId","data-v-d7200819"]]);export{Xt as default};
