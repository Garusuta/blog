import{j as Q,r as p,k as Y,l as ve,q as n,D as P,u as s,S as I,s as l,y as i,z as d,d as h,w as z,H as pe,n as fe,A as U,B as _,L as K,R as ge,T as be,F as k,C,M as he,v as x,x as T,E as _e,p as we,O as ye}from"./vue-DoCjM5oa.js";import{_ as W,u as ke,c as Ce}from"./index-BEJvXKFJ.js";import{P as xe}from"./PaginationComponent-W5xbUFCz.js";import"./libs--DbO3urw.js";import"./markdown--zrfzkwQ.js";import"./highlight-CjIDkcmk.js";import"./katex-734Zlhpu.js";const Te=["aria-expanded"],$e=Q({__name:"CustomDropdown",props:{label:{default:"选择"},buttonClass:{default:"btn btn-outline-secondary"},menuClass:{default:""},closeOnClick:{type:Boolean,default:!0}},emits:["open","close","toggle"],setup(N,{expose:S,emit:q}){const w=N,c=q,u=p(!1);function b(){u.value=!u.value,c("toggle",u.value),u.value?c("open"):c("close")}function y(){u.value&&(u.value=!1,c("close"),c("toggle",!1))}function D(r){setTimeout(()=>{(!r.relatedTarget||!r.currentTarget?.contains(r.relatedTarget))&&y()},150)}function f(r){if(w.closeOnClick){const m=r.target;(m.classList.contains("dropdown-item")||m.closest(".dropdown-item"))&&y()}}function $(r){const m=r.target;r.currentTarget.contains(m)||y()}return Y(()=>{document.addEventListener("click",$)}),ve(()=>{document.removeEventListener("click",$)}),S({close:y,open:()=>{u.value=!0,c("open"),c("toggle",!0)},toggle:b}),(r,m)=>(l(),n("div",{class:P(["custom-dropdown",{show:u.value}])},[s("button",{onClick:b,onBlur:D,class:P(["dropdown-toggle",r.buttonClass]),type:"button","aria-expanded":u.value},[I(r.$slots,"trigger",{},()=>[i(d(r.label),1)]),s("i",{class:P(["fas fa-chevron-down dropdown-icon",{rotated:u.value}])},null,2)],42,Te),s("div",{class:P(["dropdown-menu",{show:u.value,[r.menuClass]:!0}]),onClick:f},[I(r.$slots,"default",{},void 0)],2)],2))}}),j=W($e,[["__scopeId","data-v-9f9a5097"]]),Le={class:"search-page"},De={class:"container py-5"},Me={class:"row mb-5"},Se={class:"col-12"},Ee={class:"search-header text-center"},Be={class:"lead text-muted mb-4"},Pe={class:"row justify-content-center"},qe={class:"col-lg-8 col-md-10"},Fe={class:"search-input-group"},Re={class:"input-group input-group-lg"},Ve=["disabled"],je={key:0,class:"search-suggestions"},Ae={class:"list-group"},Ne=["onClick"],Oe={class:"text-muted"},He={key:0},Ie={class:"row mb-4"},ze={class:"col-12"},Ue={class:"search-stats d-flex justify-content-between align-items-center flex-wrap"},Ke={class:"search-info"},Qe={class:"mb-1"},Ye={class:"text-muted"},We={class:"text-muted mb-0"},Ze={key:0},Ge={key:0,class:"search-sort"},Je={key:0,class:"row mb-4"},Xe={class:"col-12"},es={class:"search-filters card"},ss={class:"card-body"},ts={class:"row align-items-center"},os={class:"col-md-4"},as=["onClick"],ns={class:"badge bg-secondary ms-auto"},ls={class:"col-md-4"},is=["onClick"],rs={class:"badge bg-secondary ms-auto"},ds={class:"col-md-4"},cs={key:0,class:"mt-3"},us={key:1},ms={class:"row"},vs={class:"card search-result-card h-100"},ps={class:"card-body"},fs={class:"row"},gs={class:"col-md-8"},bs={class:"card-title mb-2"},hs=["innerHTML"],_s={key:0,class:"badge bg-warning text-dark ms-2"},ws=["innerHTML"],ys={class:"mb-2"},ks={class:"search-match-info"},Cs={class:"text-success"},xs={class:"col-md-4"},Ts={class:"text-md-end"},$s={key:0,class:"mb-3"},Ls=["src","alt"],Ds={class:"text-muted small mb-3"},Ms={class:"mb-1"},Ss={class:"mb-1"},Es={key:0,class:"row mt-4"},Bs={class:"col-12"},Ps={key:2,class:"text-center py-5"},qs={class:"text-muted mb-4"},Fs={class:"mt-4"},Rs={key:1,class:"row"},Vs={class:"col-12"},js={class:"search-suggestions-section"},As={class:"row"},Ns={class:"col-md-6 mb-4"},Os={class:"card"},Hs={class:"card-body"},Is={class:"d-flex flex-wrap gap-2"},zs=["onClick"],Us={class:"badge bg-secondary ms-1"},Ks={class:"col-md-6 mb-4"},Qs={class:"card"},Ys={class:"card-body"},Ws={class:"d-flex flex-wrap gap-2"},Zs=["onClick"],Gs={class:"badge bg-primary ms-1"},A=10,Js=Q({__name:"SearchPage",setup(N){const S=pe(),q=ye(),w=ke(),c=p(""),u=p(""),b=p([]),y=p(!1),D=p(0),f=p(1),$=p("relevance"),r=p(""),m=p(""),g=p(""),E=p(!1),F=p(),O=h(()=>{if(!c.value.trim()||c.value.length<2)return[];const o=c.value.toLowerCase(),e=new Set;return w.publishedPosts.forEach(a=>{a.title.toLowerCase().split(/\s+/).forEach(t=>{t.includes(o)&&t.length>2&&e.add(t)}),a.tags.forEach(t=>{t.toLowerCase().includes(o)&&e.add(t)}),a.categories.forEach(t=>{t.toLowerCase().includes(o)&&e.add(t)})}),Array.from(e).slice(0,5)}),Z=h(()=>[...w.tags].sort((o,e)=>e.count-o.count).slice(0,8)),G=h(()=>[...w.categories].sort((o,e)=>e.count-o.count).slice(0,6)),J=h(()=>{const o=new Map;return b.value.forEach(e=>{e.post.categories.forEach(a=>{o.set(a,(o.get(a)||0)+1)})}),Array.from(o.entries()).map(([e,a])=>({name:e,count:a})).sort((e,a)=>a.count-e.count)}),X=h(()=>{const o=new Map;return b.value.forEach(e=>{e.post.tags.forEach(a=>{o.set(a,(o.get(a)||0)+1)})}),Array.from(o.entries()).map(([e,a])=>({name:e,count:a})).sort((e,a)=>a.count-e.count)}),B=h(()=>{let o=[...b.value];if(r.value&&(o=o.filter(e=>e.post.categories.includes(r.value))),m.value&&(o=o.filter(e=>e.post.tags.includes(m.value))),g.value){const e=new Date,a=new Date;switch(g.value){case"week":a.setDate(e.getDate()-7);break;case"month":a.setMonth(e.getMonth()-1);break;case"year":a.setFullYear(e.getFullYear()-1);break}o=o.filter(t=>new Date(t.post.date)>=a)}switch($.value){case"date-desc":o.sort((e,a)=>new Date(a.post.date).getTime()-new Date(e.post.date).getTime());break;case"date-asc":o.sort((e,a)=>new Date(e.post.date).getTime()-new Date(a.post.date).getTime());break;case"title-asc":o.sort((e,a)=>e.post.title.localeCompare(a.post.title));break;case"relevance":default:o.sort((e,a)=>a.score-e.score);break}return o}),H=h(()=>Math.ceil(B.value.length/A)),ee=h(()=>{const o=(f.value-1)*A,e=o+A;return B.value.slice(o,e)}),se=h(()=>r.value||m.value||g.value);function L(){if(!c.value.trim())return;const o=performance.now();u.value=c.value.trim(),b.value=w.searchPosts(u.value),y.value=!0,E.value=!1,D.value=Math.round(performance.now()-o),f.value=1,q.push({name:"Search",query:{q:u.value}})}function te(o){c.value=o,E.value=!1,L()}function oe(o){return w.searchPosts(o).length}function ae(o){c.value=o,L()}function ne(o){c.value=o,L()}function le(){r.value="",m.value="",g.value="",f.value=1}function ie(){return{"":"所有时间",week:"最近一周",month:"最近一月",year:"最近一年"}[g.value]||"所有时间"}function re(o){f.value=o,window.scrollTo({top:0,behavior:"smooth"})}function de(o){return new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}function R(o){if(!u.value)return o;const e=new RegExp(`(${u.value})`,"gi");return o.replace(e,'<mark class="bg-warning">$1</mark>')}function ce(o){const e=u.value.toLowerCase(),a=o.post.content||o.post.excerpt;if(!a)return o.post.excerpt;const t=a.toLowerCase().indexOf(e);if(t===-1)return R(o.post.excerpt);const v=Math.max(0,t-50),V=Math.min(a.length,t+e.length+50);let M=a.slice(v,V);return v>0&&(M="..."+M),V<a.length&&(M=M+"..."),R(M)}function ue(o){const e=[],a=u.value.toLowerCase();return o.post.title.toLowerCase().includes(a)&&e.push("标题"),o.post.excerpt.toLowerCase().includes(a)&&e.push("摘要"),o.post.content&&o.post.content.toLowerCase().includes(a)&&e.push("内容"),o.post.tags.some(t=>t.toLowerCase().includes(a))&&e.push("标签"),o.post.categories.some(t=>t.toLowerCase().includes(a))&&e.push("分类"),e.join(", ")||"其他"}function me(o){return o.startsWith("http")?o:`/blog/${o}`}return z(c,o=>{E.value=o.length>=2}),z([r,m,g],()=>{f.value=1}),Y(()=>{S.query.q&&(c.value=S.query.q,fe(()=>{L()})),F.value&&F.value.focus()}),(o,e)=>{const a=we("router-link");return l(),n("div",Le,[s("div",De,[s("div",Me,[s("div",Se,[s("div",Ee,[e[13]||(e[13]=s("div",{class:"search-icon mx-auto mb-3"},[s("i",{class:"fas fa-search text-primary"})],-1)),e[14]||(e[14]=s("h1",{class:"display-5 fw-bold mb-3"},"搜索文章",-1)),s("p",Be," 在 "+d(U(w).publishedPosts.length)+" 篇文章中搜索您感兴趣的内容 ",1),s("div",Pe,[s("div",qe,[s("div",Fe,[s("div",Re,[e[11]||(e[11]=s("span",{class:"input-group-text border-end-0"},[s("i",{class:"fas fa-search text-muted"})],-1)),K(s("input",{type:"text",class:"form-control border-start-0 ps-0",placeholder:"输入关键词搜索文章...","onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),onKeyup:be(L,["enter"]),ref_key:"searchInput",ref:F},null,544),[[ge,c.value]]),s("button",{class:"btn btn-primary",type:"button",onClick:L,disabled:!c.value.trim()}," 搜索 ",8,Ve)]),E.value&&O.value.length>0?(l(),n("div",je,[s("div",Ae,[(l(!0),n(k,null,C(O.value,(t,v)=>(l(),n("button",{key:v,type:"button",class:"list-group-item list-group-item-action d-flex justify-content-between align-items-center",onClick:V=>te(t)},[s("span",null,[e[12]||(e[12]=s("i",{class:"fas fa-search text-muted me-2"},null,-1)),i(" "+d(t),1)]),s("small",Oe,d(oe(t))+" 篇",1)],8,Ne))),128))])])):_("",!0)])])])])])]),y.value?(l(),n("div",He,[s("div",Ie,[s("div",ze,[s("div",Ue,[s("div",Ke,[s("h5",Qe,[e[15]||(e[15]=i(" 搜索结果 ",-1)),s("span",Ye,'"'+d(u.value)+'"',1)]),s("p",We,[i(" 找到 "+d(b.value.length)+" 篇相关文章 ",1),D.value>0?(l(),n("span",Ze,"(用时 "+d(D.value)+"ms)",1)):_("",!0)])]),b.value.length>0?(l(),n("div",Ge,[K(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>$.value=t),class:"form-select form-select-sm"},e[16]||(e[16]=[s("option",{value:"relevance"},"相关性",-1),s("option",{value:"date-desc"},"最新发布",-1),s("option",{value:"date-asc"},"最早发布",-1),s("option",{value:"title-asc"},"标题 A-Z",-1)]),512),[[he,$.value]])])):_("",!0)])])]),b.value.length>0?(l(),n("div",Je,[s("div",Xe,[s("div",es,[s("div",ss,[s("div",ts,[s("div",os,[e[20]||(e[20]=s("label",{class:"form-label mb-2"},"按分类筛选：",-1)),x(j,{label:r.value||"所有分类","button-class":"btn btn-outline-secondary w-100",onClose:e[3]||(e[3]=t=>f.value=1)},{default:T(()=>[s("div",{class:"dropdown-item",onClick:e[2]||(e[2]=t=>r.value="")},e[17]||(e[17]=[s("i",{class:"fas fa-folder me-2"},null,-1),i(" 所有分类 ",-1)])),e[19]||(e[19]=s("div",{class:"dropdown-divider"},null,-1)),(l(!0),n(k,null,C(J.value,t=>(l(),n("div",{key:t.name,class:"dropdown-item",onClick:v=>r.value=t.name},[e[18]||(e[18]=s("i",{class:"fas fa-folder me-2"},null,-1)),i(" "+d(t.name)+" ",1),s("span",ns,d(t.count),1)],8,as))),128))]),_:1,__:[19]},8,["label"])]),s("div",ls,[e[24]||(e[24]=s("label",{class:"form-label mb-2"},"按标签筛选：",-1)),x(j,{label:m.value||"所有标签","button-class":"btn btn-outline-secondary w-100",onClose:e[5]||(e[5]=t=>f.value=1)},{default:T(()=>[s("div",{class:"dropdown-item",onClick:e[4]||(e[4]=t=>m.value="")},e[21]||(e[21]=[s("i",{class:"fas fa-tags me-2"},null,-1),i(" 所有标签 ",-1)])),e[23]||(e[23]=s("div",{class:"dropdown-divider"},null,-1)),(l(!0),n(k,null,C(X.value,t=>(l(),n("div",{key:t.name,class:"dropdown-item",onClick:v=>m.value=t.name},[e[22]||(e[22]=s("i",{class:"fas fa-tag me-2"},null,-1)),i(" #"+d(t.name)+" ",1),s("span",rs,d(t.count),1)],8,is))),128))]),_:1,__:[23]},8,["label"])]),s("div",ds,[e[30]||(e[30]=s("label",{class:"form-label mb-2"},"发布时间：",-1)),x(j,{label:ie(),"button-class":"btn btn-outline-secondary w-100",onClose:e[10]||(e[10]=t=>f.value=1)},{default:T(()=>[s("div",{class:"dropdown-item",onClick:e[6]||(e[6]=t=>g.value="")},e[25]||(e[25]=[s("i",{class:"fas fa-calendar me-2"},null,-1),i(" 所有时间 ",-1)])),e[29]||(e[29]=s("div",{class:"dropdown-divider"},null,-1)),s("div",{class:"dropdown-item",onClick:e[7]||(e[7]=t=>g.value="week")},e[26]||(e[26]=[s("i",{class:"fas fa-calendar-week me-2"},null,-1),i(" 最近一周 ",-1)])),s("div",{class:"dropdown-item",onClick:e[8]||(e[8]=t=>g.value="month")},e[27]||(e[27]=[s("i",{class:"fas fa-calendar-alt me-2"},null,-1),i(" 最近一月 ",-1)])),s("div",{class:"dropdown-item",onClick:e[9]||(e[9]=t=>g.value="year")},e[28]||(e[28]=[s("i",{class:"fas fa-calendar-check me-2"},null,-1),i(" 最近一年 ",-1)]))]),_:1,__:[29]},8,["label"])])]),se.value?(l(),n("div",cs,[s("button",{class:"btn btn-outline-secondary btn-sm",onClick:le},e[31]||(e[31]=[s("i",{class:"fas fa-times me-1"},null,-1),i(" 清除筛选 ",-1)]))])):_("",!0)])])])])):_("",!0),B.value.length>0?(l(),n("div",us,[s("div",ms,[(l(!0),n(k,null,C(ee.value,t=>(l(),n("div",{key:t.post.id,class:"col-12 mb-4"},[s("div",vs,[s("div",ps,[s("div",fs,[s("div",gs,[s("h5",bs,[x(a,{to:`/post/${t.post.slug}`,class:"text-decoration-none",style:{color:"var(--text-primary)"}},{default:T(()=>[s("span",{innerHTML:R(t.post.title)},null,8,hs)]),_:2},1032,["to"]),t.post.featured?(l(),n("span",_s,e[32]||(e[32]=[s("i",{class:"fas fa-star"},null,-1),i(" 精选 ",-1)]))):_("",!0)]),s("p",{class:"card-text text-muted mb-3",innerHTML:ce(t)},null,8,ws),s("div",ys,[(l(!0),n(k,null,C(t.post.categories,v=>(l(),n("span",{key:v,class:"badge bg-primary me-1 mb-1"},d(v),1))),128)),(l(!0),n(k,null,C(t.post.tags.slice(0,3),v=>(l(),n("span",{key:v,class:"badge bg-secondary me-1 mb-1"}," #"+d(v),1))),128))]),s("div",ks,[s("small",Cs,[e[33]||(e[33]=s("i",{class:"fas fa-check-circle me-1"},null,-1)),i(" 匹配度: "+d(Math.round(t.score*100))+"% ",1),e[34]||(e[34]=s("span",{class:"mx-2"},"|",-1)),i(" 匹配字段: "+d(ue(t)),1)])])]),s("div",xs,[s("div",Ts,[t.post.image?(l(),n("div",$s,[s("img",{src:me(t.post.image),alt:t.post.title,class:"img-fluid rounded search-result-image",style:{"max-height":"120px","object-fit":"cover"}},null,8,Ls)])):_("",!0),s("div",Ds,[s("div",Ms,[e[35]||(e[35]=s("i",{class:"fas fa-user me-1"},null,-1)),i(" "+d(t.post.author),1)]),s("div",Ss,[e[36]||(e[36]=s("i",{class:"fas fa-calendar me-1"},null,-1)),i(" "+d(de(t.post.date)),1)]),s("div",null,[e[37]||(e[37]=s("i",{class:"fas fa-clock me-1"},null,-1)),i(" "+d(t.post.readTime||U(Ce)(t.post.content))+" 分钟阅读 ",1)])]),x(a,{to:`/post/${t.post.slug}`,class:"btn btn-outline-primary btn-sm"},{default:T(()=>e[38]||(e[38]=[i(" 阅读全文 ",-1),s("i",{class:"fas fa-arrow-right ms-1"},null,-1)])),_:2,__:[38]},1032,["to"])])])])])])]))),128))]),H.value>1?(l(),n("div",Es,[s("div",Bs,[x(xe,{"current-page":f.value,"total-pages":H.value,total:B.value.length,onPageChange:re},null,8,["current-page","total-pages","total"])])])):_("",!0)])):y.value?(l(),n("div",Ps,[e[41]||(e[41]=s("i",{class:"fas fa-search text-muted",style:{"font-size":"4rem"}},null,-1)),e[42]||(e[42]=s("h3",{class:"mt-3 text-muted"},"未找到相关文章",-1)),s("p",qs,' 没有找到包含 "'+d(u.value)+'" 的文章 ',1),e[43]||(e[43]=_e('<div class="search-suggestions-empty" data-v-c223fe4c><p class="mb-3" data-v-c223fe4c>您可以尝试：</p><ul class="list-unstyled" data-v-c223fe4c><li class="mb-2" data-v-c223fe4c>• 检查拼写是否正确</li><li class="mb-2" data-v-c223fe4c>• 尝试使用更通用的关键词</li><li class="mb-2" data-v-c223fe4c>• 减少搜索词的数量</li><li class="mb-2" data-v-c223fe4c>• 浏览所有文章或分类</li></ul></div>',1)),s("div",Fs,[x(a,{to:"/posts",class:"btn btn-primary me-3"},{default:T(()=>e[39]||(e[39]=[s("i",{class:"fas fa-book-open me-2"},null,-1),i(" 浏览所有文章 ",-1)])),_:1,__:[39]}),x(a,{to:"/categories",class:"btn btn-outline-primary"},{default:T(()=>e[40]||(e[40]=[s("i",{class:"fas fa-folder me-2"},null,-1),i(" 浏览分类 ",-1)])),_:1,__:[40]})])])):_("",!0)])):(l(),n("div",Rs,[s("div",Vs,[s("div",js,[e[46]||(e[46]=s("h4",{class:"mb-4 text-center"},"热门搜索",-1)),s("div",As,[s("div",Ns,[s("div",Os,[s("div",Hs,[e[44]||(e[44]=s("h6",{class:"card-title"},[s("i",{class:"fas fa-fire text-danger me-2"}),i(" 热门标签 ")],-1)),s("div",Is,[(l(!0),n(k,null,C(Z.value,t=>(l(),n("button",{key:t.name,class:"btn btn-outline-secondary btn-sm",onClick:v=>ae(t.name)},[i(" #"+d(t.name)+" ",1),s("span",Us,d(t.count),1)],8,zs))),128))])])])]),s("div",Ks,[s("div",Qs,[s("div",Ys,[e[45]||(e[45]=s("h6",{class:"card-title"},[s("i",{class:"fas fa-folder text-primary me-2"}),i(" 热门分类 ")],-1)),s("div",Ws,[(l(!0),n(k,null,C(G.value,t=>(l(),n("button",{key:t.name,class:"btn btn-outline-primary btn-sm",onClick:v=>ne(t.name)},[i(d(t.name)+" ",1),s("span",Gs,d(t.count),1)],8,Zs))),128))])])])])])])])]))])])}}}),lt=W(Js,[["__scopeId","data-v-c223fe4c"]]);export{lt as default};
