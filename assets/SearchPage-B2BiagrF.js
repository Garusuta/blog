import{j as Q,r as p,k as Y,l as me,q as l,D as B,u as s,S as z,s as n,y as i,z as d,d as h,w as I,H as ve,n as pe,A as U,B as _,L as K,R as fe,T as ge,F as k,C,M as be,v as x,x as T,E as he,p as _e,O as we}from"./vue-DoCjM5oa.js";import{_ as Z,u as ye,c as ke}from"./index-BlHxWHfa.js";import{P as Ce}from"./PaginationComponent-BFNg2W6s.js";import"./libs--DbO3urw.js";import"./markdown--zrfzkwQ.js";import"./highlight-CjIDkcmk.js";import"./katex-734Zlhpu.js";const xe=["aria-expanded"],Te=Q({__name:"CustomDropdown",props:{label:{default:"选择"},buttonClass:{default:"btn btn-outline-secondary"},menuClass:{default:""},closeOnClick:{type:Boolean,default:!0}},emits:["open","close","toggle"],setup(N,{expose:S,emit:q}){const w=N,c=q,u=p(!1);function b(){u.value=!u.value,c("toggle",u.value),u.value?c("open"):c("close")}function y(){u.value&&(u.value=!1,c("close"),c("toggle",!1))}function D(r){setTimeout(()=>{(!r.relatedTarget||!r.currentTarget?.contains(r.relatedTarget))&&y()},150)}function f(r){if(w.closeOnClick){const m=r.target;(m.classList.contains("dropdown-item")||m.closest(".dropdown-item"))&&y()}}function L(r){const m=r.target;r.currentTarget.contains(m)||y()}return Y(()=>{document.addEventListener("click",L)}),me(()=>{document.removeEventListener("click",L)}),S({close:y,open:()=>{u.value=!0,c("open"),c("toggle",!0)},toggle:b}),(r,m)=>(n(),l("div",{class:B(["custom-dropdown",{show:u.value}])},[s("button",{onClick:b,onBlur:D,class:B(["dropdown-toggle",r.buttonClass]),type:"button","aria-expanded":u.value},[z(r.$slots,"trigger",{},()=>[i(d(r.label),1)]),s("i",{class:B(["fas fa-chevron-down dropdown-icon",{rotated:u.value}])},null,2)],42,xe),s("div",{class:B(["dropdown-menu",{show:u.value,[r.menuClass]:!0}]),onClick:f},[z(r.$slots,"default",{},void 0)],2)],2))}}),j=Z(Te,[["__scopeId","data-v-9f9a5097"]]),Le={class:"search-page"},$e={class:"container py-5"},De={class:"row mb-5"},Me={class:"col-12"},Se={class:"search-header text-center"},Ee={class:"lead text-muted mb-4"},Pe={class:"row justify-content-center"},Be={class:"col-lg-8 col-md-10"},qe={class:"search-input-group"},Fe={class:"input-group input-group-lg"},Re=["disabled"],Ve={key:0,class:"search-suggestions"},je={class:"list-group"},Ae=["onClick"],Ne={class:"text-muted"},Oe={key:0},He={class:"row mb-4"},ze={class:"col-12"},Ie={class:"search-stats d-flex justify-content-between align-items-center flex-wrap"},Ue={class:"search-info"},Ke={class:"mb-1"},Qe={class:"text-muted"},Ye={class:"text-muted mb-0"},Ze={key:0},Ge={key:0,class:"search-sort"},Je={key:0,class:"row mb-4"},We={class:"col-12"},Xe={class:"search-filters card"},es={class:"card-body"},ss={class:"row align-items-center"},ts={class:"col-md-4"},os=["onClick"],as={class:"badge bg-secondary ms-auto"},ls={class:"col-md-4"},ns=["onClick"],is={class:"badge bg-secondary ms-auto"},rs={class:"col-md-4"},ds={key:0,class:"mt-3"},cs={key:1},us={class:"row"},ms={class:"card search-result-card h-100"},vs={class:"card-body"},ps={class:"row"},fs={class:"col-md-8"},gs={class:"card-title mb-2"},bs=["innerHTML"],hs={key:0,class:"badge bg-warning text-dark ms-2"},_s=["innerHTML"],ws={class:"mb-2"},ys={class:"search-match-info"},ks={class:"text-success"},Cs={class:"col-md-4"},xs={class:"text-md-end"},Ts={key:0,class:"mb-3"},Ls=["src","alt"],$s={class:"text-muted small mb-3"},Ds={class:"mb-1"},Ms={class:"mb-1"},Ss={key:0,class:"row mt-4"},Es={class:"col-12"},Ps={key:2,class:"text-center py-5"},Bs={class:"text-muted mb-4"},qs={class:"mt-4"},Fs={key:1,class:"row"},Rs={class:"col-12"},Vs={class:"search-suggestions-section"},js={class:"row"},As={class:"col-md-6 mb-4"},Ns={class:"card"},Os={class:"card-body"},Hs={class:"d-flex flex-wrap gap-2"},zs=["onClick"],Is={class:"badge bg-secondary ms-1"},Us={class:"col-md-6 mb-4"},Ks={class:"card"},Qs={class:"card-body"},Ys={class:"d-flex flex-wrap gap-2"},Zs=["onClick"],Gs={class:"badge bg-primary ms-1"},A=10,Js=Q({__name:"SearchPage",setup(N){const S=ve(),q=we(),w=ye(),c=p(""),u=p(""),b=p([]),y=p(!1),D=p(0),f=p(1),L=p("relevance"),r=p(""),m=p(""),g=p(""),E=p(!1),F=p(),O=h(()=>{if(!c.value.trim()||c.value.length<2)return[];const o=c.value.toLowerCase(),e=new Set;return w.publishedPosts.forEach(a=>{a.title.toLowerCase().split(/\s+/).forEach(t=>{t.includes(o)&&t.length>2&&e.add(t)}),a.tags.forEach(t=>{t.toLowerCase().includes(o)&&e.add(t)}),a.categories.forEach(t=>{t.toLowerCase().includes(o)&&e.add(t)})}),Array.from(e).slice(0,5)}),G=h(()=>[...w.tags].sort((o,e)=>e.count-o.count).slice(0,8)),J=h(()=>[...w.categories].sort((o,e)=>e.count-o.count).slice(0,6)),W=h(()=>{const o=new Map;return b.value.forEach(e=>{e.post.categories.forEach(a=>{o.set(a,(o.get(a)||0)+1)})}),Array.from(o.entries()).map(([e,a])=>({name:e,count:a})).sort((e,a)=>a.count-e.count)}),X=h(()=>{const o=new Map;return b.value.forEach(e=>{e.post.tags.forEach(a=>{o.set(a,(o.get(a)||0)+1)})}),Array.from(o.entries()).map(([e,a])=>({name:e,count:a})).sort((e,a)=>a.count-e.count)}),P=h(()=>{let o=[...b.value];if(r.value&&(o=o.filter(e=>e.post.categories.includes(r.value))),m.value&&(o=o.filter(e=>e.post.tags.includes(m.value))),g.value){const e=new Date,a=new Date;switch(g.value){case"week":a.setDate(e.getDate()-7);break;case"month":a.setMonth(e.getMonth()-1);break;case"year":a.setFullYear(e.getFullYear()-1);break}o=o.filter(t=>new Date(t.post.date)>=a)}switch(L.value){case"date-desc":o.sort((e,a)=>new Date(a.post.date).getTime()-new Date(e.post.date).getTime());break;case"date-asc":o.sort((e,a)=>new Date(e.post.date).getTime()-new Date(a.post.date).getTime());break;case"title-asc":o.sort((e,a)=>e.post.title.localeCompare(a.post.title));break;case"relevance":default:o.sort((e,a)=>a.score-e.score);break}return o}),H=h(()=>Math.ceil(P.value.length/A)),ee=h(()=>{const o=(f.value-1)*A,e=o+A;return P.value.slice(o,e)}),se=h(()=>r.value||m.value||g.value);function $(){if(!c.value.trim())return;const o=performance.now();u.value=c.value.trim(),b.value=w.searchPosts(u.value),y.value=!0,E.value=!1,D.value=Math.round(performance.now()-o),f.value=1,q.push({name:"Search",query:{q:u.value}})}function te(o){c.value=o,E.value=!1,$()}function oe(o){return w.searchPosts(o).length}function ae(o){c.value=o,$()}function le(o){c.value=o,$()}function ne(){r.value="",m.value="",g.value="",f.value=1}function ie(){return{"":"所有时间",week:"最近一周",month:"最近一月",year:"最近一年"}[g.value]||"所有时间"}function re(o){f.value=o,window.scrollTo({top:0,behavior:"smooth"})}function de(o){return new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}function R(o){if(!u.value)return o;const e=new RegExp(`(${u.value})`,"gi");return o.replace(e,'<mark class="bg-warning">$1</mark>')}function ce(o){const e=u.value.toLowerCase(),a=o.post.content||o.post.excerpt;if(!a)return o.post.excerpt;const t=a.toLowerCase().indexOf(e);if(t===-1)return R(o.post.excerpt);const v=Math.max(0,t-50),V=Math.min(a.length,t+e.length+50);let M=a.slice(v,V);return v>0&&(M="..."+M),V<a.length&&(M=M+"..."),R(M)}function ue(o){const e=[],a=u.value.toLowerCase();return o.post.title.toLowerCase().includes(a)&&e.push("标题"),o.post.excerpt.toLowerCase().includes(a)&&e.push("摘要"),o.post.content&&o.post.content.toLowerCase().includes(a)&&e.push("内容"),o.post.tags.some(t=>t.toLowerCase().includes(a))&&e.push("标签"),o.post.categories.some(t=>t.toLowerCase().includes(a))&&e.push("分类"),e.join(", ")||"其他"}return I(c,o=>{E.value=o.length>=2}),I([r,m,g],()=>{f.value=1}),Y(()=>{S.query.q&&(c.value=S.query.q,pe(()=>{$()})),F.value&&F.value.focus()}),(o,e)=>{const a=_e("router-link");return n(),l("div",Le,[s("div",$e,[s("div",De,[s("div",Me,[s("div",Se,[e[13]||(e[13]=s("div",{class:"search-icon mx-auto mb-3"},[s("i",{class:"fas fa-search text-primary"})],-1)),e[14]||(e[14]=s("h1",{class:"display-5 fw-bold mb-3"},"搜索文章",-1)),s("p",Ee," 在 "+d(U(w).publishedPosts.length)+" 篇文章中搜索您感兴趣的内容 ",1),s("div",Pe,[s("div",Be,[s("div",qe,[s("div",Fe,[e[11]||(e[11]=s("span",{class:"input-group-text border-end-0"},[s("i",{class:"fas fa-search text-muted"})],-1)),K(s("input",{type:"text",class:"form-control border-start-0 ps-0",placeholder:"输入关键词搜索文章...","onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),onKeyup:ge($,["enter"]),ref_key:"searchInput",ref:F},null,544),[[fe,c.value]]),s("button",{class:"btn btn-primary",type:"button",onClick:$,disabled:!c.value.trim()}," 搜索 ",8,Re)]),E.value&&O.value.length>0?(n(),l("div",Ve,[s("div",je,[(n(!0),l(k,null,C(O.value,(t,v)=>(n(),l("button",{key:v,type:"button",class:"list-group-item list-group-item-action d-flex justify-content-between align-items-center",onClick:V=>te(t)},[s("span",null,[e[12]||(e[12]=s("i",{class:"fas fa-search text-muted me-2"},null,-1)),i(" "+d(t),1)]),s("small",Ne,d(oe(t))+" 篇",1)],8,Ae))),128))])])):_("",!0)])])])])])]),y.value?(n(),l("div",Oe,[s("div",He,[s("div",ze,[s("div",Ie,[s("div",Ue,[s("h5",Ke,[e[15]||(e[15]=i(" 搜索结果 ",-1)),s("span",Qe,'"'+d(u.value)+'"',1)]),s("p",Ye,[i(" 找到 "+d(b.value.length)+" 篇相关文章 ",1),D.value>0?(n(),l("span",Ze,"(用时 "+d(D.value)+"ms)",1)):_("",!0)])]),b.value.length>0?(n(),l("div",Ge,[K(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>L.value=t),class:"form-select form-select-sm"},e[16]||(e[16]=[s("option",{value:"relevance"},"相关性",-1),s("option",{value:"date-desc"},"最新发布",-1),s("option",{value:"date-asc"},"最早发布",-1),s("option",{value:"title-asc"},"标题 A-Z",-1)]),512),[[be,L.value]])])):_("",!0)])])]),b.value.length>0?(n(),l("div",Je,[s("div",We,[s("div",Xe,[s("div",es,[s("div",ss,[s("div",ts,[e[20]||(e[20]=s("label",{class:"form-label mb-2"},"按分类筛选：",-1)),x(j,{label:r.value||"所有分类","button-class":"btn btn-outline-secondary w-100",onClose:e[3]||(e[3]=t=>f.value=1)},{default:T(()=>[s("div",{class:"dropdown-item",onClick:e[2]||(e[2]=t=>r.value="")},e[17]||(e[17]=[s("i",{class:"fas fa-folder me-2"},null,-1),i(" 所有分类 ",-1)])),e[19]||(e[19]=s("div",{class:"dropdown-divider"},null,-1)),(n(!0),l(k,null,C(W.value,t=>(n(),l("div",{key:t.name,class:"dropdown-item",onClick:v=>r.value=t.name},[e[18]||(e[18]=s("i",{class:"fas fa-folder me-2"},null,-1)),i(" "+d(t.name)+" ",1),s("span",as,d(t.count),1)],8,os))),128))]),_:1,__:[19]},8,["label"])]),s("div",ls,[e[24]||(e[24]=s("label",{class:"form-label mb-2"},"按标签筛选：",-1)),x(j,{label:m.value||"所有标签","button-class":"btn btn-outline-secondary w-100",onClose:e[5]||(e[5]=t=>f.value=1)},{default:T(()=>[s("div",{class:"dropdown-item",onClick:e[4]||(e[4]=t=>m.value="")},e[21]||(e[21]=[s("i",{class:"fas fa-tags me-2"},null,-1),i(" 所有标签 ",-1)])),e[23]||(e[23]=s("div",{class:"dropdown-divider"},null,-1)),(n(!0),l(k,null,C(X.value,t=>(n(),l("div",{key:t.name,class:"dropdown-item",onClick:v=>m.value=t.name},[e[22]||(e[22]=s("i",{class:"fas fa-tag me-2"},null,-1)),i(" #"+d(t.name)+" ",1),s("span",is,d(t.count),1)],8,ns))),128))]),_:1,__:[23]},8,["label"])]),s("div",rs,[e[30]||(e[30]=s("label",{class:"form-label mb-2"},"发布时间：",-1)),x(j,{label:ie(),"button-class":"btn btn-outline-secondary w-100",onClose:e[10]||(e[10]=t=>f.value=1)},{default:T(()=>[s("div",{class:"dropdown-item",onClick:e[6]||(e[6]=t=>g.value="")},e[25]||(e[25]=[s("i",{class:"fas fa-calendar me-2"},null,-1),i(" 所有时间 ",-1)])),e[29]||(e[29]=s("div",{class:"dropdown-divider"},null,-1)),s("div",{class:"dropdown-item",onClick:e[7]||(e[7]=t=>g.value="week")},e[26]||(e[26]=[s("i",{class:"fas fa-calendar-week me-2"},null,-1),i(" 最近一周 ",-1)])),s("div",{class:"dropdown-item",onClick:e[8]||(e[8]=t=>g.value="month")},e[27]||(e[27]=[s("i",{class:"fas fa-calendar-alt me-2"},null,-1),i(" 最近一月 ",-1)])),s("div",{class:"dropdown-item",onClick:e[9]||(e[9]=t=>g.value="year")},e[28]||(e[28]=[s("i",{class:"fas fa-calendar-check me-2"},null,-1),i(" 最近一年 ",-1)]))]),_:1,__:[29]},8,["label"])])]),se.value?(n(),l("div",ds,[s("button",{class:"btn btn-outline-secondary btn-sm",onClick:ne},e[31]||(e[31]=[s("i",{class:"fas fa-times me-1"},null,-1),i(" 清除筛选 ",-1)]))])):_("",!0)])])])])):_("",!0),P.value.length>0?(n(),l("div",cs,[s("div",us,[(n(!0),l(k,null,C(ee.value,t=>(n(),l("div",{key:t.post.id,class:"col-12 mb-4"},[s("div",ms,[s("div",vs,[s("div",ps,[s("div",fs,[s("h5",gs,[x(a,{to:`/post/${t.post.slug}`,class:"text-decoration-none",style:{color:"var(--text-primary)"}},{default:T(()=>[s("span",{innerHTML:R(t.post.title)},null,8,bs)]),_:2},1032,["to"]),t.post.featured?(n(),l("span",hs,e[32]||(e[32]=[s("i",{class:"fas fa-star"},null,-1),i(" 精选 ",-1)]))):_("",!0)]),s("p",{class:"card-text text-muted mb-3",innerHTML:ce(t)},null,8,_s),s("div",ws,[(n(!0),l(k,null,C(t.post.categories,v=>(n(),l("span",{key:v,class:"badge bg-primary me-1 mb-1"},d(v),1))),128)),(n(!0),l(k,null,C(t.post.tags.slice(0,3),v=>(n(),l("span",{key:v,class:"badge bg-secondary me-1 mb-1"}," #"+d(v),1))),128))]),s("div",ys,[s("small",ks,[e[33]||(e[33]=s("i",{class:"fas fa-check-circle me-1"},null,-1)),i(" 匹配度: "+d(Math.round(t.score*100))+"% ",1),e[34]||(e[34]=s("span",{class:"mx-2"},"|",-1)),i(" 匹配字段: "+d(ue(t)),1)])])]),s("div",Cs,[s("div",xs,[t.post.image?(n(),l("div",Ts,[s("img",{src:t.post.image,alt:t.post.title,class:"img-fluid rounded search-result-image",style:{"max-height":"120px","object-fit":"cover"}},null,8,Ls)])):_("",!0),s("div",$s,[s("div",Ds,[e[35]||(e[35]=s("i",{class:"fas fa-user me-1"},null,-1)),i(" "+d(t.post.author),1)]),s("div",Ms,[e[36]||(e[36]=s("i",{class:"fas fa-calendar me-1"},null,-1)),i(" "+d(de(t.post.date)),1)]),s("div",null,[e[37]||(e[37]=s("i",{class:"fas fa-clock me-1"},null,-1)),i(" "+d(t.post.readTime||U(ke)(t.post.content))+" 分钟阅读 ",1)])]),x(a,{to:`/post/${t.post.slug}`,class:"btn btn-outline-primary btn-sm"},{default:T(()=>e[38]||(e[38]=[i(" 阅读全文 ",-1),s("i",{class:"fas fa-arrow-right ms-1"},null,-1)])),_:2,__:[38]},1032,["to"])])])])])])]))),128))]),H.value>1?(n(),l("div",Ss,[s("div",Es,[x(Ce,{"current-page":f.value,"total-pages":H.value,total:P.value.length,onPageChange:re},null,8,["current-page","total-pages","total"])])])):_("",!0)])):y.value?(n(),l("div",Ps,[e[41]||(e[41]=s("i",{class:"fas fa-search text-muted",style:{"font-size":"4rem"}},null,-1)),e[42]||(e[42]=s("h3",{class:"mt-3 text-muted"},"未找到相关文章",-1)),s("p",Bs,' 没有找到包含 "'+d(u.value)+'" 的文章 ',1),e[43]||(e[43]=he('<div class="search-suggestions-empty" data-v-7e277534><p class="mb-3" data-v-7e277534>您可以尝试：</p><ul class="list-unstyled" data-v-7e277534><li class="mb-2" data-v-7e277534>• 检查拼写是否正确</li><li class="mb-2" data-v-7e277534>• 尝试使用更通用的关键词</li><li class="mb-2" data-v-7e277534>• 减少搜索词的数量</li><li class="mb-2" data-v-7e277534>• 浏览所有文章或分类</li></ul></div>',1)),s("div",qs,[x(a,{to:"/posts",class:"btn btn-primary me-3"},{default:T(()=>e[39]||(e[39]=[s("i",{class:"fas fa-book-open me-2"},null,-1),i(" 浏览所有文章 ",-1)])),_:1,__:[39]}),x(a,{to:"/categories",class:"btn btn-outline-primary"},{default:T(()=>e[40]||(e[40]=[s("i",{class:"fas fa-folder me-2"},null,-1),i(" 浏览分类 ",-1)])),_:1,__:[40]})])])):_("",!0)])):(n(),l("div",Fs,[s("div",Rs,[s("div",Vs,[e[46]||(e[46]=s("h4",{class:"mb-4 text-center"},"热门搜索",-1)),s("div",js,[s("div",As,[s("div",Ns,[s("div",Os,[e[44]||(e[44]=s("h6",{class:"card-title"},[s("i",{class:"fas fa-fire text-danger me-2"}),i(" 热门标签 ")],-1)),s("div",Hs,[(n(!0),l(k,null,C(G.value,t=>(n(),l("button",{key:t.name,class:"btn btn-outline-secondary btn-sm",onClick:v=>ae(t.name)},[i(" #"+d(t.name)+" ",1),s("span",Is,d(t.count),1)],8,zs))),128))])])])]),s("div",Us,[s("div",Ks,[s("div",Qs,[e[45]||(e[45]=s("h6",{class:"card-title"},[s("i",{class:"fas fa-folder text-primary me-2"}),i(" 热门分类 ")],-1)),s("div",Ys,[(n(!0),l(k,null,C(J.value,t=>(n(),l("button",{key:t.name,class:"btn btn-outline-primary btn-sm",onClick:v=>le(t.name)},[i(d(t.name)+" ",1),s("span",Gs,d(t.count),1)],8,Zs))),128))])])])])])])])]))])])}}}),lt=Z(Js,[["__scopeId","data-v-7e277534"]]);export{lt as default};
